'use strict';

var responses = {
    '404': { message: 'Not found.' }
};

/**
 * Processes a message from the triumph-be API and calls the appropriate
 * callback, parsing any JSON data and putting it in the correct error/
 * data object.
 *
 * @param error The error received from the triumph-be API.
 * @param response The response received from the triumph-be API.
 * @param body The body (content) received from the triumph-be API.
 * @param options Any additional options, such as the callback provided
 *                by the API client.
 */
function handleResponse(error, response, body, options) {
    if (error) {
        options.callback(error, { message: error.message });
    }
    else if (response.statusCode == 200) {
        // Success!
        let responseData = (typeof body === 'string') ? JSON.parse(body) : body;
        options.callback(null, responseData);
    }
    else {
        var errorData = JSON.parse(body);
        let responseData = {
            statusCode: response.statusCode,
            message: responses[response.statusCode] ? responses[response.statusCode].message : 'Unknown error.',
            errorMessage: errorData.message
        };

        options.callback(responseData, { message: errorData.message });
    }
}

module.exports = handleResponse;